<!doctype html> 
<html lang="en"> 
<head> 
	<meta charset="UTF-8" />
	<title>QWOP in JavaScript</title>
	<style type="text/css">
	body {
		margin: 32;
		font-family:verdana;

	}
</style>
</head>
<body>

	<!-- Text for each section of the data collection -->
	<div id="text"></div>

	<!-- iframe used in each secction - holds google form or a qwop game -->
	<iframe id = "iframe" name = "iframe">Loading...</iframe>

	<p><button onclick="increaseCounter()" type="button" id="next_button">Next</button></p>
	<p id ="timer"></p>

	<script>
		window.onload = setupPage;
		var qwopPlayMinutes = 10;

		function increaseCounter() {
			if(typeof(Storage) !== "undefined") {
				if (sessionStorage.clickcount) {
					sessionStorage.clickcount = Number(sessionStorage.clickcount)+1;
				} else {
					sessionStorage.clickcount = 1;
				}
			} else {
				document.getElementById("text").innerHTML = "Sorry, your browser does not support web storage...";
			}
			changeData();
		}
		function setupPage() {
			// Setup storage
			if(typeof(Storage) !== "undefined") {
				sessionStorage.clickcount = 1;
			} else {
				document.getElementById("text").innerHTML = "Sorry, your browser does not support web storage...";
			}
			// Setup timers for game lengths, data collection for games etc.
			setupTimer();

			// Fill the div and iframe with the stuff on the first section
			changeData();
		}
		function changeData() {
			text = document.getElementById("text");
			timer = document.getElementById("timer");
			iframe = document.getElementById("iframe");
			next_button = document.getElementById("next_button");
			resetTimer();
			if (sessionStorage.clickcount == 1) {
				// Intro Questionnaire 
				// Text above the iframe
				text.innerHTML = 
				"<h1>Data collection for Part II Project - section " + sessionStorage.clickcount + "/5</h1>"
				+"<p>Thanks for taking part in the data collection.</p>"
				+"<p>Please first fill in the form below.</p>"
				+"<p>Once completed move on to the next section of the data collection by clicking the next button below the form.</p>"
				+"<br>";

				// Item in iframe for this section
				iframe.src="https://docs.google.com/forms/d/e/1FAIpQLSc7PnFh20KTh5B9Q5csM6tUFxedDTlRgW3nZAiIdGL90nBbDQ/viewform?embedded=true";
				iframe.width="960";
				iframe.height="540";
				iframe.frameborder="0";
				iframe.marginheight="0";
				iframe.marginwidth="0";
				iframe.scrolling="yes";
			} else if (sessionStorage.clickcount == 2) {
				// First game of QWOP
				// Text above the iframe
				text.innerHTML = 
				"<h1>Data collection for Part II Project - section " + sessionStorage.clickcount + "/5</h1>"
				+"<p>Now play this game of qwop for for 5 mins, aim to get as high a score as possible.</p>"
				+"<p>This bit would normally move on to the next section when the time is up, but atm just skip with next button to see the other bits.</p>"
				+"<br>";
				// Item in iframe for this section
				iframe.src="http://www.foddy.net/Athletics.html?webgl=true";
				iframe.width = 640;
				iframe.height = 400;
				iframe.scrolling="no";
				iframe.frameborder="0";
				iframe.marginheight="0";
				iframe.marginwidth="0";
				// Make button invisible
				//next_button.style="display: none;";
			} else if (sessionStorage.clickcount == 3) {
				// Second version of QWOP
				// Text above the iframe
				text.innerHTML = 
				"<h1>Data collection for Part II Project - section " + sessionStorage.clickcount + "/5</h1>"
				+"<p>Next up we'll try my game for 5 mins.</p>"
				+"<p>Again this bit will move automatically move on to the next section when the time is up, but press next to see other bits.</p>"
				+"<br>";
				// Item in iframe for this section
				iframe.src="https://rawgit.com/gla23/Part2Project/master/QWOPjs.html";
				iframe.width = 960;
				iframe.height = 540;
				iframe.frameborder="0";
				iframe.scrolling="no";
				iframe.marginheight="0";
				iframe.marginwidth="0";
			} else if (sessionStorage.clickcount == 4) {
				// Final questionnaire
				// Text above the iframe
				text.innerHTML = 
				"<h1>Data collection for Part II Project - section " + sessionStorage.clickcount + "/5</h1>"
				+"<p>Now that you have played the games, here is a final questionnaire. </p>"
				+"<p>When it has been successfully submitted, click next below.</p>"
				+"<br>";

				// Item in iframe for this section
				iframe.src="https://docs.google.com/forms/d/e/1FAIpQLSdZkZ07C2fZLBTDI8fqRgnaGzqou3OJqzMpm1z2o0bKo3scYg/viewform?embedded=true";
				iframe.width="960";
				iframe.height="540";
				iframe.scrolling="yes";
				iframe.frameborder="0";
				iframe.marginheight="0";
				iframe.marginwidth="0";
				// Make button visible again
				next_button.style="display: ;";
			} else if (sessionStorage.clickcount == 5) {
				// Thanks at end
				// Text above the iframe
				text.innerHTML = 
				"<h1>Data collection for Part II Project - section " + sessionStorage.clickcount + "/5</h1>"
				+"<p>Thanks for taking part all the needed data has been collected. </p>"
				+"<p>feel free to close this tab.</p>"
				+"<br>";
				// Remove iframe and next button
				iframe.parentNode.removeChild(iframe);
				next_button.parentNode.removeChild(next_button);
				timer.parentNode.removeChild(timer);
			}

		}
		function resetTimer() {
			timer.startTime = new Date().getTime();
		}
		function setupTimer() {
			resetTimer();
			// Update the count down every 1 second
			var x = setInterval(function() {

				// Get today's date and time
				var now = new Date().getTime();
				// Display distance of current time from start time
				var distance = now - timer.startTime;
				var minutes = Math.floor(distance / (1000 * 60));
				var seconds = Math.floor((distance % (1000 * 60)) / 1000);
				timer.innerHTML = minutes + "m " + seconds + "s ";

				// Act when the timer gets to specific points
				if (distance < 10000) {
					//timer.innerHTML = "less than 10 secs";
				}

				if (distance > qwopPlayMinutes*1000*60*60) {
					// Move on the next section
					//x.clearInterval();k
				}
			}, 1000);
		}
	</script>

</body>
</html>